(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6958],{7739:(e,s,a)=>{Promise.resolve().then(a.bind(a,392))},6098:(e,s,a)=>{"use strict";a.d(s,{Ve:()=>t,zi:()=>l}),a(5155),a(7690);let t="https://api.cloudinary.com/v1_1/dipztwslj/upload",l="bookimages"},957:(e,s,a)=>{"use strict";a.d(s,{A:()=>c});var t=a(5155),l=a(2115),r=a(4194),i=a(7058),n=a(6098);a(6104);let c=e=>{let{chatId:s,name:a,profilePic:c}=e,[d,o]=(0,l.useState)([]),[m,u]=(0,l.useState)(""),[g,h]=(0,l.useState)(null);(0,l.useEffect)(()=>{if(!s||!r.j2.currentUser)return;let e=(0,i.H9)(r.db,"chats",s),a=(0,i.aQ)(e,e=>{e.exists()&&o(e.data().messages||[])});return()=>a()},[s]);let p=async()=>{if(!m.trim()||!r.j2.currentUser)return;let e=r.j2.currentUser,a=Date.now(),t={senderId:e.uid,text:m.trim(),timestamp:a,type:"text",...g&&{replyTo:{...g.text&&{text:g.text},...g.imageUrl&&{imageUrl:g.imageUrl},senderId:g.senderId}}},l=(0,i.H9)(r.db,"chats",s);try{let r=await (0,i.x7)(l);if(r.exists()){let e=r.data().messages||[];await (0,i.mZ)(l,{messages:[...e,t],lastMessage:t.text,lastMessageTime:a})}else await (0,i.BN)(l,{chatId:s,buyerId:e.uid,sellerId:"",messages:[t],lastMessage:t.text,lastMessageTime:a});u(""),h(null)}catch(e){console.error("❌ Failed to send text message:",e)}},x=async e=>{var s;let a=null===(s=e.target.files)||void 0===s?void 0:s[0];if(!a||!r.j2.currentUser)return;let t=new FormData;t.append("file",a),t.append("upload_preset",n.zi);try{let e=await fetch(n.Ve,{method:"POST",body:t}),s=await e.json();s.secure_url?j(s.secure_url):console.warn("⚠️ Cloudinary returned no secure_url.")}catch(e){console.error("❌ Image upload failed:",e)}},j=async e=>{let a=r.j2.currentUser;if(!a||!e)return;let t=Date.now(),l={senderId:a.uid,imageUrl:e,timestamp:t,type:"image",...g&&{replyTo:{...g.text&&{text:g.text},...g.imageUrl&&{imageUrl:g.imageUrl},senderId:g.senderId}}},n=(0,i.H9)(r.db,"chats",s);try{let e=await (0,i.x7)(n);if(e.exists()){let s=e.data().messages||[];await (0,i.mZ)(n,{messages:[...s,l],lastMessage:"[Image]",lastMessageTime:t})}else await (0,i.BN)(n,{chatId:s,buyerId:a.uid,sellerId:"",messages:[l],lastMessage:"[Image]",lastMessageTime:t});h(null)}catch(e){console.error("❌ sendImageMessage failed:",e)}};return(0,t.jsxs)("div",{className:"chat-container",children:[(0,t.jsxs)("div",{className:"chat-header",children:[(0,t.jsx)("img",{src:c,alt:a,className:"chat-profile-pic"}),(0,t.jsx)("h3",{children:a})]}),(0,t.jsx)("div",{className:"chat-messages",children:d.length>0?d.map((e,s)=>{var a;let l=!e.type||"text"===e.type,i="image"===e.type;return(0,t.jsxs)("div",{className:"message ".concat(e.senderId===(null===(a=r.j2.currentUser)||void 0===a?void 0:a.uid)?"sent":"received"),onClick:()=>h(e),children:[e.replyTo&&(0,t.jsxs)("div",{className:"reply-preview-inside",children:[(0,t.jsx)("strong",{children:"Replying to:"})," ",e.replyTo.text?e.replyTo.text:e.replyTo.imageUrl?"[Image]":""]}),l&&(0,t.jsx)("p",{children:e.text}),i&&e.imageUrl&&(0,t.jsx)("img",{src:e.imageUrl,alt:"Sent",className:"chat-image"})]},s)}):(0,t.jsx)("p",{className:"no-messages",children:"No messages yet."})}),(0,t.jsxs)("div",{className:"chat-input",children:[g&&(0,t.jsxs)("div",{className:"reply-preview-box",children:[(0,t.jsxs)("p",{children:["Replying to:"," ",g.text?g.text:g.imageUrl?"[Image]":""]}),(0,t.jsx)("button",{onClick:()=>h(null),children:"\\u2716"})]}),(0,t.jsx)("input",{type:"text",placeholder:"Type a message...",value:m,onChange:e=>u(e.target.value),onKeyDown:e=>"Enter"===e.key&&p()}),(0,t.jsx)("button",{onClick:p,children:"Send"}),(0,t.jsxs)("label",{htmlFor:"imageUpload",className:"upload-button",children:[(0,t.jsx)("img",{src:"/upload.png"}),(0,t.jsx)("input",{type:"file",id:"imageUpload",accept:"image/*",onChange:x,style:{display:"none"}})]})]})]})}},9995:(e,s,a)=>{"use strict";a.d(s,{A:()=>l});var t=a(5155);a(2115),a(5170);let l=e=>{let{name:s,profilePic:a,isOnline:l,lastMessage:r,lastMessageTime:i,onClick:n}=e;return(0,t.jsxs)("div",{className:"singlecontact",onClick:n,children:[(0,t.jsx)("img",{src:a,alt:"Profile"}),(0,t.jsxs)("div",{className:"contacttext",children:[(0,t.jsxs)("div",{className:"toprow",children:[(0,t.jsx)("h3",{children:s}),i&&(0,t.jsx)("span",{className:"time",children:i})]}),(0,t.jsx)("div",{className:"bottomrow",children:(0,t.jsx)("p",{className:"lastmessage",children:(null==r?void 0:r.startsWith("[Image]"))?"[Image]":r})})]})]})}},4194:(e,s,a)=>{"use strict";a.d(s,{db:()=>c,j2:()=>n});var t=a(9904),l=a(7058),r=a(4565);let i=(0,t.Wp)({apiKey:"AIzaSyBJ_h8hsYSrF6n_aUHNcSM9Sxarjy9vdis",authDomain:"homelibrary-3eb02.firebaseapp.com",projectId:"homelibrary-3eb02",storageBucket:"homelibrary-3eb02.firebasestorage.app",messagingSenderId:"193740511363",appId:"1:193740511363:web:1aa41e575c0e79ae3be3b6"}),n=(0,r.xI)(i),c=(0,l.aU)(i)},392:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>o});var t=a(5155),l=a(2115),r=a(4194),i=a(7058),n=a(4565);a(4471);var c=a(9995),d=a(957);let o=()=>{let[e,s]=(0,l.useState)([]),[a,o]=(0,l.useState)(null),[m,u]=(0,l.useState)(!0);(0,l.useEffect)(()=>{let e=(0,n.hg)(r.j2,e=>{if(!e)return;let a=e.uid,t=(0,i.rJ)(r.db,"chats"),l=(0,i.P)(t,(0,i._M)("sellerId","==",a)),n=(0,i.aQ)(l,async e=>{try{let a=(await Promise.all(e.docs.map(async e=>{let s=e.data();if(!s.buyerId||!s.lastMessageTime)return null;let a=(0,i.H9)(r.db,"users",s.buyerId),t=await (0,i.x7)(a);if(!t.exists())return null;let l=t.data();return{chatId:s.chatId||e.id,name:"".concat(l.fname," ").concat(l.lname),profilePic:l.profilepicture||"/default-profile.png",lastMessage:s.lastMessage||"",lastMessageTime:s.lastMessageTime||0}}))).filter(Boolean);s(a),u(!1)}catch(e){console.error("Error loading seller chats:",e),u(!1)}});return()=>n()});return()=>e()},[]);let g=e=>e?new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"",h=e=>{o(e)};return(0,t.jsx)("div",{className:"main-container",children:(0,t.jsxs)("div",{className:"allchatcontainer",children:[(0,t.jsxs)("div",{className:"contactContainer",children:[(0,t.jsx)("h3",{children:"CONTACTS"}),m?(0,t.jsx)("p",{children:"Loading contacts..."}):e.length>0?e.map(e=>(0,t.jsx)("div",{onClick:()=>h(e),children:(0,t.jsx)(c.A,{name:e.name,profilePic:e.profilePic,isOnline:!0,lastMessage:e.lastMessage,lastMessageTime:g(e.lastMessageTime)})},e.chatId)):(0,t.jsx)("p",{children:"No active chats"})]}),(0,t.jsx)("div",{className:"chatContainer",children:a?(0,t.jsx)(d.A,{chatId:a.chatId,name:a.name,profilePic:a.profilePic}):(0,t.jsx)("p",{children:"Select a contact to start chatting"})})]})})}},6104:()=>{},5170:()=>{},4471:()=>{}},e=>{var s=s=>e(e.s=s);e.O(0,[8334,4107,9895,2992,7512,4778,7970,7690,8441,1517,7358],()=>s(7739)),_N_E=e.O()}]);