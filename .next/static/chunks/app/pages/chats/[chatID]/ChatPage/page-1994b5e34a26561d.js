(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5169],{1744:(e,s,a)=>{Promise.resolve().then(a.bind(a,8175))},6098:(e,s,a)=>{"use strict";a.d(s,{Ve:()=>r,zi:()=>t}),a(5155),a(7690);let r="https://api.cloudinary.com/v1_1/dipztwslj/upload",t="bookimages"},957:(e,s,a)=>{"use strict";a.d(s,{A:()=>c});var r=a(5155),t=a(2115),l=a(4194),i=a(7058),n=a(6098);a(6104);let c=e=>{let{chatId:s,name:a,profilePic:c}=e,[d,o]=(0,t.useState)([]),[h,m]=(0,t.useState)(""),[u,g]=(0,t.useState)(null);(0,t.useEffect)(()=>{if(!s||!l.j2.currentUser)return;let e=(0,i.H9)(l.db,"chats",s),a=(0,i.aQ)(e,e=>{e.exists()&&o(e.data().messages||[])});return()=>a()},[s]);let x=async()=>{if(!h.trim()||!l.j2.currentUser)return;let e=l.j2.currentUser,a=Date.now(),r={senderId:e.uid,text:h.trim(),timestamp:a,type:"text",...u&&{replyTo:{...u.text&&{text:u.text},...u.imageUrl&&{imageUrl:u.imageUrl},senderId:u.senderId}}},t=(0,i.H9)(l.db,"chats",s);try{let l=await (0,i.x7)(t);if(l.exists()){let e=l.data().messages||[];await (0,i.mZ)(t,{messages:[...e,r],lastMessage:r.text,lastMessageTime:a})}else await (0,i.BN)(t,{chatId:s,buyerId:e.uid,sellerId:"",messages:[r],lastMessage:r.text,lastMessageTime:a});m(""),g(null)}catch(e){console.error("❌ Failed to send text message:",e)}},j=async e=>{var s;let a=null===(s=e.target.files)||void 0===s?void 0:s[0];if(!a||!l.j2.currentUser)return;let r=new FormData;r.append("file",a),r.append("upload_preset",n.zi);try{let e=await fetch(n.Ve,{method:"POST",body:r}),s=await e.json();s.secure_url?p(s.secure_url):console.warn("⚠️ Cloudinary returned no secure_url.")}catch(e){console.error("❌ Image upload failed:",e)}},p=async e=>{let a=l.j2.currentUser;if(!a||!e)return;let r=Date.now(),t={senderId:a.uid,imageUrl:e,timestamp:r,type:"image",...u&&{replyTo:{...u.text&&{text:u.text},...u.imageUrl&&{imageUrl:u.imageUrl},senderId:u.senderId}}},n=(0,i.H9)(l.db,"chats",s);try{let e=await (0,i.x7)(n);if(e.exists()){let s=e.data().messages||[];await (0,i.mZ)(n,{messages:[...s,t],lastMessage:"[Image]",lastMessageTime:r})}else await (0,i.BN)(n,{chatId:s,buyerId:a.uid,sellerId:"",messages:[t],lastMessage:"[Image]",lastMessageTime:r});g(null)}catch(e){console.error("❌ sendImageMessage failed:",e)}};return(0,r.jsxs)("div",{className:"chat-container",children:[(0,r.jsxs)("div",{className:"chat-header",children:[(0,r.jsx)("img",{src:c,alt:a,className:"chat-profile-pic"}),(0,r.jsx)("h3",{children:a})]}),(0,r.jsx)("div",{className:"chat-messages",children:d.length>0?d.map((e,s)=>{var a;let t=!e.type||"text"===e.type,i="image"===e.type;return(0,r.jsxs)("div",{className:"message ".concat(e.senderId===(null===(a=l.j2.currentUser)||void 0===a?void 0:a.uid)?"sent":"received"),onClick:()=>g(e),children:[e.replyTo&&(0,r.jsxs)("div",{className:"reply-preview-inside",children:[(0,r.jsx)("strong",{children:"Replying to:"})," ",e.replyTo.text?e.replyTo.text:e.replyTo.imageUrl?"[Image]":""]}),t&&(0,r.jsx)("p",{children:e.text}),i&&e.imageUrl&&(0,r.jsx)("img",{src:e.imageUrl,alt:"Sent",className:"chat-image"})]},s)}):(0,r.jsx)("p",{className:"no-messages",children:"No messages yet."})}),(0,r.jsxs)("div",{className:"chat-input",children:[u&&(0,r.jsxs)("div",{className:"reply-preview-box",children:[(0,r.jsxs)("p",{children:["Replying to:"," ",u.text?u.text:u.imageUrl?"[Image]":""]}),(0,r.jsx)("button",{onClick:()=>g(null),children:"\\u2716"})]}),(0,r.jsx)("input",{type:"text",placeholder:"Type a message...",value:h,onChange:e=>m(e.target.value),onKeyDown:e=>"Enter"===e.key&&x()}),(0,r.jsx)("button",{onClick:x,children:"Send"}),(0,r.jsxs)("label",{htmlFor:"imageUpload",className:"upload-button",children:[(0,r.jsx)("img",{src:"/upload.png"}),(0,r.jsx)("input",{type:"file",id:"imageUpload",accept:"image/*",onChange:j,style:{display:"none"}})]})]})]})}},9995:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});var r=a(5155);a(2115),a(5170);let t=e=>{let{name:s,profilePic:a,isOnline:t,lastMessage:l,lastMessageTime:i,onClick:n}=e;return(0,r.jsxs)("div",{className:"singlecontact",onClick:n,children:[(0,r.jsx)("img",{src:a,alt:"Profile"}),(0,r.jsxs)("div",{className:"contacttext",children:[(0,r.jsxs)("div",{className:"toprow",children:[(0,r.jsx)("h3",{children:s}),i&&(0,r.jsx)("span",{className:"time",children:i})]}),(0,r.jsx)("div",{className:"bottomrow",children:(0,r.jsx)("p",{className:"lastmessage",children:(null==l?void 0:l.startsWith("[Image]"))?"[Image]":l})})]})]})}},5517:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});var r=a(5155);a(2115),a(7276);let t=()=>(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)("div",{className:"FooterContainer",children:[(0,r.jsxs)("div",{className:"BookInfo",children:[(0,r.jsx)("img",{src:"/logo.png",alt:"Logoo",className:"logoo"}),(0,r.jsx)("p",{className:"about",children:"Book Bridge is your trusted online marketplace for buying and selling pre-loved books. Join our community of readers and give books a second life while finding affordable reads."}),(0,r.jsxs)("p",{className:"contactf",children:[(0,r.jsx)("b",{style:{color:"#F4AD0F"},children:"Email:"})," support@bookbridge.com",(0,r.jsx)("br",{}),(0,r.jsx)("b",{style:{color:"#F4AD0F"},children:"Phone:"})," +1-800-BOOK-123",(0,r.jsx)("br",{}),(0,r.jsx)("b",{style:{color:"#F4AD0F"},children:"Address:"})," 123 Book Lane, Reader’s City, CA, USA",(0,r.jsx)("br",{})]}),(0,r.jsx)("p",{className:"reserve",children:"All rights reserved @bookbridge 2024"})]}),(0,r.jsxs)("div",{className:"Links",children:[(0,r.jsx)("h5",{style:{color:"#F4AD0F"},children:"Quick Links"}),(0,r.jsxs)("ul",{children:[(0,r.jsx)("li",{children:(0,r.jsx)("a",{href:"",children:"Home"})}),(0,r.jsx)("li",{children:(0,r.jsx)("a",{href:"",children:"Browse Books"})}),(0,r.jsx)("li",{children:(0,r.jsx)("a",{href:"",children:"Sell Books"})}),(0,r.jsx)("li",{children:(0,r.jsx)("a",{href:"",children:"Wishlist"})}),(0,r.jsx)("li",{children:(0,r.jsx)("a",{href:"",children:"FAQ"})}),(0,r.jsx)("li",{children:(0,r.jsx)("a",{href:"",children:"Contact Us"})})]})]}),(0,r.jsxs)("div",{className:"SocialMedia",children:[(0,r.jsxs)("center",{children:[(0,r.jsx)("h1",{children:"FOLLOW US"}),(0,r.jsx)("h1",{children:"SOCIAL MEDIA"})]}),(0,r.jsx)("center",{children:(0,r.jsxs)("span",{className:"iconsfooter",children:[(0,r.jsx)("a",{href:"",children:(0,r.jsx)("img",{src:"/fb.svg"})}),(0,r.jsx)("a",{href:"",children:(0,r.jsx)("img",{src:"/insta.svg"})}),(0,r.jsx)("a",{href:"",children:(0,r.jsx)("img",{src:"/twi.svg"})}),(0,r.jsx)("a",{href:"",children:(0,r.jsx)("img",{src:"/yt.svg"})})]})})]})]})})},3357:(e,s,a)=>{"use strict";a.d(s,{default:()=>c});var r=a(5155),t=a(2115),l=a(6046),i=a(4565);a(3720);var n=a(929);let c=()=>{let[e,s]=(0,t.useState)(!1),[a,c]=(0,t.useState)(null),[d,o]=(0,t.useState)(!1),h=(0,l.useRouter)();(0,t.useEffect)(()=>{let e=(0,i.xI)(),s=(0,i.hg)(e,e=>{c(e)});return()=>s()},[]);let m=e=>{o(!0),setTimeout(()=>{h.push(e),o(!1)},3e3)};return(0,r.jsxs)(r.Fragment,{children:[d&&(0,r.jsx)(n.A,{}),(0,r.jsxs)("div",{className:"MenuContainer",children:[(0,r.jsx)("a",{href:"/",children:(0,r.jsx)("img",{src:"/logo.png",alt:"Logo",className:"headerlogo"})}),(0,r.jsx)("nav",{className:"top-nav ".concat(e?"open":""),children:(0,r.jsxs)("ul",{children:[(0,r.jsx)("li",{children:(0,r.jsx)("a",{href:"/",children:"HOME"})}),(0,r.jsx)("li",{children:(0,r.jsx)("a",{href:"/pages/BrowsePage",children:"BROWSE"})}),(0,r.jsx)("li",{children:(0,r.jsx)("a",{href:"/pages/AboutUs",children:"ABOUT US"})}),(0,r.jsx)("li",{children:(0,r.jsx)("a",{href:"/pages/ContactUS",children:"CONTACT US"})})]})}),(0,r.jsx)("button",{className:"sellbutton",onClick:()=>m(a?"/pages/SellerDashboard/".concat(a.uid,"/AddBook/"):"/pages/LoginPages/userlogin/"),children:"SELL A BOOK"}),(0,r.jsx)("a",{onClick:()=>m(a?"/pages/chats/".concat(a.uid,"/ChatPage"):"/pages/LoginPages/userlogin/"),style:{cursor:"pointer"},children:(0,r.jsx)("img",{src:"/chat.png",className:"chat",alt:"Chat"})}),(0,r.jsx)("a",{href:"/pages/LoginPages/userlogin",children:(0,r.jsx)("img",{src:"/acc.svg",className:"acc",alt:"Account"})}),(0,r.jsx)("button",{className:"menu-toggle",onClick:()=>{s(!e)},children:(0,r.jsx)("img",{src:"/menu-icon.svg",alt:"Menu"})})]})]})}},929:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});var r=a(5155);a(2115),a(4892);let t=()=>(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)("div",{className:"loading-overlay",children:[(0,r.jsx)("div",{className:"loading-spinner"}),(0,r.jsx)("p",{children:"Loading..."})]})})},4194:(e,s,a)=>{"use strict";a.d(s,{db:()=>c,j2:()=>n});var r=a(9904),t=a(7058),l=a(4565);let i=(0,r.Wp)({apiKey:"AIzaSyBJ_h8hsYSrF6n_aUHNcSM9Sxarjy9vdis",authDomain:"homelibrary-3eb02.firebaseapp.com",projectId:"homelibrary-3eb02",storageBucket:"homelibrary-3eb02.firebasestorage.app",messagingSenderId:"193740511363",appId:"1:193740511363:web:1aa41e575c0e79ae3be3b6"}),n=(0,l.xI)(i),c=(0,t.aU)(i)},8175:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>m});var r=a(5155),t=a(2115),l=a(4194),i=a(7058),n=a(4565);a(7760);var c=a(3357),d=a(5517),o=a(9995),h=a(957);let m=()=>{let[e,s]=(0,t.useState)([]),[a,m]=(0,t.useState)(null),[u,g]=(0,t.useState)(!0);(0,t.useEffect)(()=>{let e=(0,n.hg)(l.j2,e=>{if(!e)return;let a=(0,i.rJ)(l.db,"chats"),r=(0,i.P)(a,(0,i._M)("buyerId","==",e.uid)),t=(0,i.aQ)(r,async e=>{try{let a=(await Promise.all(e.docs.map(async e=>{let s=e.data();if(!s.sellerId||!s.lastMessageTime)return null;let a=(0,i.H9)(l.db,"users",s.sellerId),r=await (0,i.x7)(a);if(!r.exists())return null;let t=r.data();return{chatId:s.chatId||e.id,name:"".concat(t.fname," ").concat(t.lname),profilePic:t.profilepicture||"/default-profile.png",lastMessage:s.lastMessage||"",lastMessageTime:s.lastMessageTime||0}}))).filter(Boolean);s(a),g(!1)}catch(e){console.error("❌ Error loading buyer chats:",e),g(!1)}});return()=>t()});return()=>e()},[]);let x=e=>e?new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"";return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(c.default,{}),(0,r.jsx)("br",{}),(0,r.jsxs)("div",{className:"allchatcontainer",children:[(0,r.jsxs)("div",{className:"contactContainer",children:[(0,r.jsx)("h3",{children:"CONTACTS"}),u?(0,r.jsx)("p",{children:"Loading contacts..."}):e.length>0?e.map(e=>(0,r.jsx)("div",{onClick:()=>m(e),className:"contactRow",children:(0,r.jsx)(o.A,{name:e.name,profilePic:e.profilePic,isOnline:!0,lastMessage:e.lastMessage,lastMessageTime:x(e.lastMessageTime)})},e.chatId)):(0,r.jsx)("p",{children:"No active chats"})]}),(0,r.jsx)("div",{className:"chatContainer",children:a?(0,r.jsx)(h.A,{chatId:a.chatId,name:a.name,profilePic:a.profilePic}):(0,r.jsx)("p",{children:"Select a contact to start chatting"})})]}),(0,r.jsx)(d.A,{})]})}},6046:(e,s,a)=>{"use strict";var r=a(6658);a.o(r,"useParams")&&a.d(s,{useParams:function(){return r.useParams}}),a.o(r,"useRouter")&&a.d(s,{useRouter:function(){return r.useRouter}}),a.o(r,"useSearchParams")&&a.d(s,{useSearchParams:function(){return r.useSearchParams}})},6104:()=>{},5170:()=>{},7276:()=>{},3720:()=>{},4892:()=>{},7760:()=>{}},e=>{var s=s=>e(e.s=s);e.O(0,[3809,3945,4725,2293,4107,9895,2992,7512,4778,7970,7690,8441,1517,7358],()=>s(1744)),_N_E=e.O()}]);